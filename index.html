<!DOCTYPE html>
<!--
  MIT License
  
  Copyright (c) 2026 Biraj Bhattarai
  
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  
  The above copyright notice and this permission notice shall be included in all
  copies or substantial portions of the Software.
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Investigator - Real-Time Voting</title>
  <style>
    /* ===== MOBILE-FIRST RESPONSIVE DESIGN ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', monospace;
      background-color: #1a1a1a;
      color: #ffffff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== HEADER ===== */
    .header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: #000000;
      border: 3px solid #FFC300;
      position: relative;
      box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
    }

    .header::before {
      content: '‚ö†Ô∏è CRIME SCENE - DO NOT CROSS ‚ö†Ô∏è';
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      background: #DC143C;
      color: #FFC300;
      padding: 0.3rem 1rem;
      font-size: 0.75rem;
      font-weight: 900;
      letter-spacing: 2px;
      border: 2px solid #FFC300;
    }

    .header h1 {
      font-size: 1.75rem;
      color: #FFC300;
      text-shadow: 0 0 15px #FFC300, 2px 2px 4px #000000;
      margin-bottom: 0.5rem;
      font-weight: 900;
      letter-spacing: 2px;
    }

    .header p {
      font-size: 0.875rem;
      color: #DC143C;
      text-shadow: 0 0 10px #DC143C, 1px 1px 2px #000000;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .header-actions {
      margin-top: 1rem;
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .header-link {
      display: inline-block;
      padding: 0.75rem 1.25rem;
      background: #1a1a1a;
      color: #FFC300;
      border: 3px solid #DC143C;
      text-decoration: none;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 2px;
      box-shadow: 0 4px 0 #8B0000;
      transition: all 0.2s ease;
    }

    .header-link:hover {
      background: #DC143C;
      color: #FFC300;
      border-color: #FFC300;
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(220, 20, 60, 0.8), 0 4px 0 #FFC300;
    }

    /* ===== VOTING GRID (Phase 1 Main Content) ===== */
    .voting-section {
      opacity: 1;
      transition: opacity 0.6s ease-in-out;
    }

    .voting-section.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .voting-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    @media (min-width: 600px) {
      .voting-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
      }
    }

    @media (min-width: 1024px) {
      .voting-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 2rem;
      }
    }

    /* ===== VOTING CARD (Suspect Card with Photo) ===== */
    .voting-card {
      background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
      border: 3px solid #FFC300;
      border-radius: 0;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.8), 0 0 0 2px #DC143C;
      position: relative;
    }

    .voting-card::before {
      content: '‚ö†Ô∏è';
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.5rem;
      z-index: 10;
      filter: drop-shadow(0 0 5px #FFC300);
    }

    .voting-card:hover {
      border-color: #DC143C;
      box-shadow: 0 8px 25px rgba(220, 20, 60, 0.6), 0 0 0 3px #FFC300;
      transform: translateY(-8px);
    }

    /* ===== SUSPECT PHOTO SECTION ===== */
    .suspect-photo {
      width: 100%;
      height: auto;
      background: linear-gradient(135deg, #DC143C, #8B0000);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: rgba(255, 195, 0, 0.3);
      overflow: hidden;
      border-bottom: 3px solid #FFC300;
      position: relative;
    }

    .suspect-photo::after {
      content: 'EVIDENCE';
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: #000000;
      color: #FFC300;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      font-weight: 900;
      letter-spacing: 1px;
      border: 2px solid #FFC300;
    }

    .suspect-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: grayscale(30%) contrast(1.2);
    }

    /* ===== SUSPECT INFO SECTION ===== */
    .suspect-info {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      flex-grow: 1;
      background: #1a1a1a;
    }

    .voting-card h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #FFC300;
      text-shadow: 0 0 10px rgba(255, 195, 0, 0.5), 2px 2px 4px #000000;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .voting-card p {
      font-size: 0.875rem;
      color: #ffffff;
      margin-bottom: 1.5rem;
      line-height: 1.4;
      text-shadow: 1px 1px 2px #000000;
    }

    /* ===== ACTION BUTTON (Min-height 60px for mobile accessibility) ===== */
    .vote-button {
      background: #FFC300;
      color: #000000;
      border: 3px solid #DC143C;
      padding: 1rem 1.5rem;
      border-radius: 0;
      font-size: 1rem;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      letter-spacing: 2px;
      box-shadow: 0 4px 0 #8B0000, 0 5px 10px rgba(0, 0, 0, 0.5);
      position: relative;
    }

    .vote-button:hover {
      background: #DC143C;
      color: #FFC300;
      border-color: #FFC300;
      box-shadow: 0 0 20px rgba(255, 195, 0, 0.8), 0 4px 0 #FFC300;
      transform: translateY(-2px);
    }

    .vote-button:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #8B0000;
    }

    .vote-button:disabled {
      background-color: #666666;
      color: #cccccc;
      cursor: not-allowed;
      opacity: 0.6;
      border-color: #666666;
    }

    /* ===== CONFIRMATION MESSAGE ===== */
    .confirmation {
      background-color: #1a1a1a;
      border: 3px solid #FFC300;
      border-radius: 0;
      padding: 1.5rem;
      margin-top: 1.5rem;
      text-align: center;
      color: #FFC300;
      font-weight: 900;
      animation: slideIn 0.4s ease-in-out;
      box-shadow: 0 0 15px rgba(255, 195, 0, 0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* ===== ERROR MESSAGE ===== */
    .error-message {
      background-color: #1a0000;
      border: 3px solid #DC143C;
      border-radius: 0;
      padding: 1rem;
      color: #DC143C;
      text-align: center;
      margin-bottom: 1.5rem;
      animation: slideIn 0.4s ease-in-out;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
    }

    /* ===== LOADING STATE ===== */
    .loading {
      display: inline-block;
      width: 12px;
      height: 12px;
      background-color: #FFC300;
      border-radius: 50%;
      animation: pulse 1s infinite;
      box-shadow: 0 0 10px #FFC300;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header Section -->
    <div class="header">
      <h1>ÔøΩ CRIME SCENE INVESTIGATION üö®</h1>
      <p>‚ö†Ô∏è Who is the Culprit? Cast Your Accusation ‚ö†Ô∏è</p>
      <div class="header-actions">
        <a class="header-link" href="feedback.html">üìù Submit Evidence</a>
      </div>
    </div>

    <!-- Voting Section (Phase 1 - Primary) -->
    <div id="votingSection" class="voting-section">
      <div id="errorMessage"></div>
      <div id="votingGrid" class="voting-grid">
        <!-- Voting cards will be dynamically inserted here -->
      </div>
    </div>
  </div>

  <!-- Firebase SDK (Compat SDK for Realtime Database) -->
  <!-- Configuration block with clear comments -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    /* ===== FIREBASE CONFIGURATION ===== */
    // Initialize Firebase with your project credentials
    // Replace these values with your Firebase project configuration
    const firebaseConfig = {
  apiKey: "AIzaSyC1bxz29svF9y_5V-8VJz0NaMsIzVOAwhI",
  authDomain: "online-voting-b970f.firebaseapp.com",
  databaseURL: "https://online-voting-b970f-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "online-voting-b970f",
  storageBucket: "online-voting-b970f.firebasestorage.app",
  messagingSenderId: "784746686625",
  appId: "1:784746686625:web:eb6a565d11d7240d48a8e0"
};
    

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    /* ===== SUSPECT DATA (4 Suspects - "Who is the Culprit?" Game) ===== */
    const suspectOptions = [
      {
        id: 'suspect1',
        name: 'Lydia Mercer',
        role: 'First Year Student',
        motive: 'age 23 - Campus access & knowledge',
        photoUrl: 'images/lydia.jpg'
      },
      {
        id: 'suspect2',
        name: 'Marco Vale',
        role: 'Final Year Student',
        motive: 'age 27 - Academic pressure & secrets',
        photoUrl: 'images/marco.jpg'
      },
      {
        id: 'suspect3',
        name: 'Noah Kade',
        role: 'Lab Assistant',
        motive: 'age 32 - Lab access & expertise',
        photoUrl: 'images/noah.jpg'
      },
      {
        id: 'suspect4',
        name: 'Theo Ash',
        role: 'Third Year Student',
        motive: 'age 25 - Hidden connections',
        photoUrl: 'images/theo.jpg'
      }
    ];

    let hasVoted = false;
    let currentVote = null;

    /* ===== INITIALIZE VOTING GRID ===== */
    function initializeVotingGrid() {
      const grid = document.getElementById('votingGrid');
      grid.innerHTML = ''; // Clear previous content

      suspectOptions.forEach(suspect => {
        const card = document.createElement('div');
        card.className = 'voting-card';
        card.innerHTML = `
          <div class="suspect-photo">
            <img src="${suspect.photoUrl}" alt="${suspect.name}" onerror="this.style.display='none'">
          </div>
          <div class="suspect-info">
            <div>
              <h3>${suspect.name}</h3>
              <p><strong>Role:</strong> ${suspect.role}</p>
              <p><strong>Motive:</strong> ${suspect.motive}</p>
            </div>
            <button class="vote-button" onclick="castVote('${suspect.id}', '${suspect.name}')">
              Accuse
            </button>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    /* ===== CAST VOTE (Firebase Transaction for Atomicity) ===== */
    function castVote(optionId, optionTitle) {
      if (hasVoted) {
        showError('You have already voted. Use ‚ÄúSubmit Evidence‚Äù to leave feedback.');
        return;
      }

      // Disable all buttons during transaction
      disableAllButtons();

      // Use Firebase transaction to ensure atomicity during high-traffic voting
      db.ref('votes/' + optionId).transaction(currentValue => {
        return (currentValue || 0) + 1;
      }).then(result => {
        if (result.committed) {
          hasVoted = true;
          currentVote = optionTitle;
          console.log(`‚úì Vote recorded for: ${optionTitle}`);
          window.location.href = `feedback.html?option=${encodeURIComponent(optionTitle)}`;
        }
      }).catch(error => {
        enableAllButtons();
        showError('Failed to cast vote. Please try again.');
        console.error('Transaction failed:', error);
      });
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.innerHTML = `<div class="error-message">${message}</div>`;
      setTimeout(() => {
        errorDiv.innerHTML = '';
      }, 5000);
    }

    function disableAllButtons() {
      document.querySelectorAll('.vote-button').forEach(btn => {
        btn.disabled = true;
      });
    }

    function enableAllButtons() {
      document.querySelectorAll('.vote-button').forEach(btn => {
        btn.disabled = false;
      });
    }

    /* ===== INITIALIZE ON PAGE LOAD ===== */
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üîç Digital Investigator - Participant Portal Initialized');
      initializeVotingGrid();
    });
  </script>
</body>
</html>
